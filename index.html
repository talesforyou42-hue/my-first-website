<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Writer Visual Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ---------- GLOBAL ---------- */
body{
  font-family: 'Segoe UI', sans-serif;
  margin:0;
  background:linear-gradient(135deg,#1e1e1e,#3a3a3a);
  color:#eee;
}

/* ---------- HEADER ---------- */
header{
  text-align:center;
  padding:2rem 1rem;
  background:linear-gradient(90deg,#ff4d6d,#845ec2);
}
header h1{
  margin:0;
  font-size:2.2rem;
}
header p{
  opacity:.9;
}

/* ---------- SECTIONS ---------- */
section{
  background:#1f1f1f;
  margin:1.5rem auto;
  padding:1.5rem;
  border-radius:14px;
  max-width:900px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}

h2,h3{
  color:#ffd369;
  margin-top:0;
}

/* ---------- FORM ---------- */
textarea,input,select{
  width:100%;
  margin-top:6px;
  padding:10px;
  border-radius:8px;
  border:none;
  background:#2b2b2b;
  color:#fff;
}

textarea::placeholder,input::placeholder{
  color:#aaa;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:20px;
  background:linear-gradient(90deg,#ff4d6d,#ffb703);
  color:#000;
  font-weight:600;
  cursor:pointer;
}
button:hover{opacity:.9}

/* ---------- FACE ---------- */
img{
  max-width:150px;
  border-radius:10px;
  margin-top:10px;
}
.locked{color:#4dff88;font-weight:bold}

/* ---------- LIST ---------- */
ul{padding-left:20px}
li{cursor:pointer;margin:6px 0}
li:hover{color:#ffd369}

/* ---------- PROMPT ---------- */
.prompt-box{
  background:#111;
  padding:14px;
  border-radius:10px;
  white-space:pre-wrap;
  border:1px dashed #444;
}

/* ---------- IMAGE PREVIEW ---------- */
#generated-image{
  max-width:100%;
  display:none;
  margin-top:15px;
  border-radius:14px;
}
#loading{
  color:#aaa;
  font-style:italic;
}
</style>
</head>

<body>

<header>
<h1>Writer Visual Tool</h1>
<p>Manhwa-style character & scene studio</p>
</header>

<!-- CHARACTER CREATOR -->
<section>
<h2>Character Creator (Face Locked)</h2>

<label>Character Name</label>
<input id="char-name" placeholder="Asha">

<label>Character Description</label>
<textarea id="char-desc"
placeholder="Manhwa style adult woman, calm, confident"></textarea>

<h3>Face Lock (Required)</h3>
<input type="file" id="face-upload" accept="image/*">
<img id="face-preview" style="display:none">
<p id="face-status">No face locked</p>
<button id="lock-face">Lock Face</button>

<hr>

<button id="save-character">Save Character</button>
</section>

<!-- SCENE BUILDER -->
<section>
<h2>Scene Builder</h2>

<label>Face Expression</label>
<select id="expression">
<option>Neutral</option>
<option>Smile</option>
<option>Seductive</option>
<option>Angry</option>
<option>Shy</option>
</select>

<label>Emotion Intensity</label>
<select id="intensity">
<option>Low</option>
<option>Medium</option>
<option>High</option>
</select>

<label>Scene Location</label>
<input id="location" placeholder="Bedroom">

<label>Time</label>
<select id="time">
<option>Day</option>
<option>Night</option>
</select>

<label>Lighting</label>
<input id="lighting" placeholder="Soft lamp light">

<label>Background Mood</label>
<input id="mood" placeholder="Quiet, tense, intimate">

<button id="generate-image">Generate Image</button>

<p id="loading"></p>
<img id="generated-image">
</section>

<!-- OUTPUT -->
<section>
<h2>Final Image Prompt</h2>
<div id="final-prompt" class="prompt-box">No prompt yet.</div>
</section>

<!-- CHARACTER LIST -->
<section>
<h2>Saved Characters</h2>
<ul id="character-list"></ul>
</section>

<script>
/* ---------- FACE LOCK ---------- */
const faceUpload=document.getElementById('face-upload');
const facePreview=document.getElementById('face-preview');
const faceStatus=document.getElementById('face-status');
let faceLocked=false,faceData=null;

faceUpload.onchange=()=>{
  const f=faceUpload.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{
    facePreview.src=r.result;
    facePreview.style.display='block';
    faceData=r.result;
  };
  r.readAsDataURL(f);
};

document.getElementById('lock-face').onclick=()=>{
  if(!faceData){alert("Upload face first");return;}
  faceLocked=true;
  faceUpload.disabled=true;
  faceStatus.textContent="Face Locked ✅";
  faceStatus.className="locked";
};

/* ---------- STORAGE ---------- */
const getChars=()=>JSON.parse(localStorage.getItem("characters"))||[];
const saveChars=c=>localStorage.setItem("characters",JSON.stringify(c));

/* ---------- SAVE CHARACTER ---------- */
document.getElementById('save-character').onclick=()=>{
  const n=char-name.value.trim(),d=char-desc.value.trim();
  if(!n||!d||!faceLocked){alert("Complete character first");return;}
  const c=getChars();
  if(c.some(x=>x.name.toLowerCase()==n.toLowerCase()))return alert("Already exists");
  c.push({name:n,desc:d,face:faceData});
  saveChars(c);render();
};

/* ---------- LIST ---------- */
const list=document.getElementById('character-list');
let active=null;
function render(){
  list.innerHTML='';
  getChars().forEach(x=>{
    const li=document.createElement('li');
    li.textContent=x.name;
    li.onclick=()=>active=x;
    list.appendChild(li);
  });
}
render();

/* ---------- GENERATE IMAGE (DEMO) ---------- */
document.getElementById('generate-image').onclick=()=>{
  if(!active)return alert("Select character");
  const prompt=`
Manhwa style illustration,
${active.name},
${active.desc},
expression ${expression.value} (${intensity.value}),
${location.value}, ${time.value},
${lighting.value}, ${mood.value}
`.trim();

  document.getElementById('final-prompt').textContent=prompt;
  loading.textContent="Generating image…";
  generated-image.style.display="none";

  setTimeout(()=>{
    generated-image.src="https://placekitten.com/768/768";
    generated-image.style.display="block";
    loading.textContent="";
  },2000);
};
</script>

</body>
</html>
