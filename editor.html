<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manhwa Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}

/* COLOURFUL BACKGROUND */
body{
  margin:0;
  font-family:"Segoe UI", Arial, sans-serif;
  min-height:100vh;
  background:
    radial-gradient(circle at 10% 20%, #ff9a9e, transparent 40%),
    radial-gradient(circle at 90% 30%, #fad0c4, transparent 40%),
    radial-gradient(circle at 50% 80%, #fbc2eb, transparent 45%),
    linear-gradient(135deg,#a18cd1,#fbc2eb);
  overflow-x:hidden;
}

/* Wrapper */
.page-wrapper{
  display:flex;
  justify-content:center;
  padding:20px;
  width:100%;
}

/* PAGE CARD */
.page{
  background:white;
  width:380px;
  min-height:90vh;
  border-radius:18px;
  padding:14px;
  box-shadow:0 30px 60px rgba(0,0,0,0.25);
}

/* Top Bar */
.topbar{
  text-align:center;
  color:white;
  font-weight:700;
  padding:18px 0;
  font-size:1.4rem;
}

/* PANEL â€” ðŸ”¥ Smoky Manhwa Look */
.panel{
  width:100%;
  min-height:160px;
  border:2px solid #222;
  border-radius:6px;
  margin-bottom:14px;
  position:relative;
  overflow:hidden;
  font-size:0.95rem;
  padding-bottom:26px;

  background:linear-gradient(
      to bottom right,
      rgba(255,255,255,0.92),
      rgba(235,235,235,0.88),
      rgba(210,210,210,0.80)
  );
  backdrop-filter: blur(2px);
  background-size:cover;
  background-position:center;
}

/* Text */
.editor-box{
  width:100%;
  height:100%;
  padding:10px;
  outline:none;
  color:#111;
  font-weight:500;
  z-index:2;
  position:relative;
  text-shadow:none;
}

/* Character PNG */
.char-img{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  max-height:90%;
  z-index:3;
}

/* Tool Buttons */
.tools{
  position:absolute;
  left:6px;
  top:6px;
  display:flex;
  gap:4px;
  z-index:5;
}
.tools button{
  padding:2px 6px;
  font-size:10px;
  background:#111;
  color:white;
  border:none;
  border-radius:4px;
}

/* RESIZE BAR */
.resize-bar{
  position:absolute;
  bottom:0;
  left:0;
  width:100%;
  height:22px;
  background:#ddd;
  cursor:grab;
  text-align:center;
  font-size:11px;
  color:#333;
  user-select:none;
  border-top:1px solid #aaa;
  z-index:4;
}

/* Delete */
.delete-panel{
  position:absolute;
  right:6px;
  top:6px;
  background:red;
  color:white;
  border:none;
  font-size:11px;
  padding:2px 6px;
  border-radius:4px;
  z-index:7;
}

/* Add */
.add-panel{
  width:100%;
  padding:12px;
  border:none;
  border-radius:24px;
  background:#ff5f6d;
  color:white;
  font-weight:700;
  font-size:1rem;
  margin-top:8px;
}

/* Clear */
.clear-all{
  margin-top:12px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:20px;
  background:black;
  color:white;
  font-weight:600;
}
</style>
</head>

<body>

<div class="topbar">ðŸ“œ Create Your Manhwa</div>

<div class="page-wrapper">
  <div class="page" id="page"></div>
</div>

<script>
let resizing=false, activePanel=null,startY=0,startH=0;

/* ------------ RESIZE SYSTEM ------------ */
document.addEventListener("mousedown",startResize);
document.addEventListener("mousemove",doResize);
document.addEventListener("mouseup",stopResize);
document.addEventListener("touchstart",startResize,{passive:false});
document.addEventListener("touchmove",doResize,{passive:false});
document.addEventListener("touchend",stopResize);

function startResize(e){
  const bar=e.target.closest(".resize-bar");
  if(!bar)return;
  resizing=true;
  activePanel=bar.parentNode;
  startY=e.touches?e.touches[0].clientY:e.clientY;
  startH=activePanel.offsetHeight;
  document.body.style.overflow="hidden";
}
function doResize(e){
  if(!resizing)return;
  const y=e.touches?e.touches[0].clientY:e.clientY;
  const diff=y-startY;
  activePanel.style.height=Math.max(120,startH+diff)+"px";
}
function stopResize(){
  resizing=false;
  activePanel=null;
  document.body.style.overflow="auto";
  saveAll();
}

/* ------------ PANEL CREATION ------------ */
function newPanel(data={}){
  const panel=document.createElement("div");
  panel.className="panel";
  panel.style.height=(data.height||"200px");
  panel.style.backgroundImage=data.bg?`url(${data.bg})`:"none";

  let html=`
    <div class="tools">
      <button onclick="uploadBG(this)">BG</button>
      <button onclick="uploadChar(this)">CHR</button>
      <button onclick="aiGen(this)">AI</button>
    </div>
    <div class="editor-box" contenteditable="true">${data.text||"New sceneâ€¦"}</div>
    <div class="resize-bar">â‡• resize</div>
    <button class="delete-panel" onclick="deletePanel(this)">x</button>
  `;
  panel.innerHTML=html;

  if(data.char){
    const img=document.createElement("img");
    img.src=data.char;
    img.className="char-img";
    panel.appendChild(img);
  }

  return panel;
}

/* ------------ ADD PANEL ------------ */
function addPanel(data={}){
  const page=document.getElementById("page");
  const panel=newPanel(data);
  page.appendChild(panel);
  saveAll();
}

/* DELETE */
function deletePanel(btn){
  btn.parentNode.remove();
  saveAll();
}

/* BG Upload */
function uploadBG(btn){
  const panel=btn.closest(".panel");
  const file=document.createElement("input");
  file.type="file"; file.accept="image/*";
  file.onchange=e=>{
    const f=e.target.files[0];
    if(!f)return;
    const reader=new FileReader();
    reader.onload=ev=>{
      panel.style.backgroundImage=`url(${ev.target.result})`;
      saveAll();
    };
    reader.readAsDataURL(f);
  };
  file.click();
}

/* CHAR Upload */
function uploadChar(btn){
  const panel=btn.closest(".panel");
  const file=document.createElement("input");
  file.type="file"; file.accept="image/*";
  file.onchange=e=>{
    const f=e.target.files[0];
    if(!f)return;
    const reader=new FileReader();
    reader.onload=ev=>{
      const img=document.createElement("img");
      img.src=ev.target.result;
      img.className="char-img";
      panel.appendChild(img);
      saveAll();
    };
    reader.readAsDataURL(f);
  };
  file.click();
}

/* AI BUTTON */
function aiGen(btn){
  const panel=btn.closest(".panel");
  panel.querySelector(".editor-box").innerText+="\n[AI: Scene Pending]";
  saveAll();
}

/* SAVE */
function saveAll(){
  const panels=[...document.querySelectorAll(".panel")].map(p=>{
    const char=p.querySelector(".char-img");
    return {
      text:p.querySelector(".editor-box").innerText,
      bg:p.style.backgroundImage.replace('url("','').replace('")','')||"",
      char:char?char.src:"",
      height:p.style.height
    };
  });
  localStorage.setItem("manhwa",JSON.stringify(panels));
}

/* LOAD */
function loadAll(){
  const page=document.getElementById("page");
  const saved=JSON.parse(localStorage.getItem("manhwa")||"[]");
  if(saved.length){
    saved.forEach(p=>addPanel(p));
  } else {
    addPanel({text:"Start your scene..."});
  }
}
loadAll();

/* CLEAR */
function clearAll(){
  localStorage.removeItem("manhwa");
  document.getElementById("page").innerHTML="";
  addPanel({text:"Start fresh..."});
}
</script>

<button class="clear-all" onclick="clearAll()">Clear All</button>

</body>
</html>
