<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manhwa Free Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;touch-action:none}
body{
  margin:0;
  font-family:"Segoe UI", Arial, sans-serif;
  min-height:100vh;
  background:linear-gradient(135deg,#ff9a9e,#fad0c4,#fbc2eb,#a18cd1);
  overflow:hidden;
}

/* CANVAS */
.canvas{
  position:relative;
  width:100%;
  height:100vh;
  overflow:auto;
  padding:70px 0 90px;
}

/* PANEL NOW FREE FLOATING */
.panel{
  position:absolute;
  top:80px;
  left:20px;
  width:280px;
  height:200px;
  border:2px solid #000;
  border-radius:10px;
  background:#eeeeee;
  overflow:hidden;
  z-index:10;
}

.bg-layer{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  z-index:1;
}

.char-img{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  max-height:95%;
  z-index:2;
}

.caption{
  position:absolute;
  bottom:0;
  width:100%;
  background:rgba(0,0,0,0.7);
  color:white;
  padding:6px;
  font-size:0.9rem;
  z-index:3;
}

/* TOOLS */
.tools{
  position:absolute;
  top:6px; left:6px;
  display:flex; gap:5px;
  z-index:4;
}
.tools button{
  padding:2px 6px;
  font-size:10px;
  border:none;
  background:#222;
  color:white;
  border-radius:4px;
}

/* DELETE */
.delete-panel{
  position:absolute;
  top:6px; right:6px;
  background:red;color:white;
  border:none;padding:3px 6px;
  border-radius:4px;
  font-size:11px;
  z-index:4;
}

/* RESIZE 4 HANDLES */
.resize{
  width:12px;height:12px;
  background:#666;
  position:absolute;
  border-radius:2px;
  z-index:20;
}
.resize.br{bottom:0;right:0;cursor:nwse-resize;}
.resize.bl{bottom:0;left:0;cursor:nesw-resize;}
.resize.tr{top:0;right:0;cursor:nesw-resize;}
.resize.tl{top:0;left:0;cursor:nwse-resize;}
</style>
</head>

<body>

<div class="canvas" id="canvas"></div>

<!-- Input Bar -->
<div style="
  position:fixed;bottom:0;left:0;width:100%;
  background:white;border-top:2px solid #ccc;
  display:flex;gap:8px;padding:10px;">
  <input id="scene" placeholder="Scene description..."
   style="flex:1;padding:12px;border-radius:20px;border:1px solid #aaa;">
  <button onclick="addPanel()" style="
    padding:12px 20px;border:none;border-radius:20px;
    background:#ff5f6d;color:white;font-weight:bold;">
    Add Scene
  </button>
</div>

<script>
let active=null,startX=0,startY=0,startW=0,startH=0,startLeft=0,startTop=0;

function addPanel(){
  const text=document.getElementById("scene").value.trim()||"New Scene...";
  const canvas=document.getElementById("canvas");

  const panel=document.createElement("div");
  panel.className="panel";
  panel.innerHTML=`
    <div class="bg-layer"></div>
    <div class="tools">
      <button onclick="bg(this)">BG</button>
      <button onclick="chr(this)">CHR</button>
    </div>
    <button class="delete-panel" onclick="this.parentNode.remove()">x</button>
    <div class="caption">${text}</div>
    <div class="resize tl"></div>
    <div class="resize tr"></div>
    <div class="resize bl"></div>
    <div class="resize br"></div>
  `;
  
  canvas.appendChild(panel);
  enableDrag(panel);
  enableResize(panel);
  document.getElementById("scene").value="";
}

/* BG upload */
function bg(btn){
  const p=btn.closest(".panel");
  const bg=p.querySelector(".bg-layer");
  const f=document.createElement("input");
  f.type="file";f.accept="image/*";
  f.onchange=e=>{
    const r=new FileReader();
    r.onload=x=>bg.style.backgroundImage=`url(${x.target.result})`;
    r.readAsDataURL(e.target.files[0]);
  };
  f.click();
}

/* CHAR upload */
function chr(btn){
  const p=btn.closest(".panel");
  const f=document.createElement("input");
  f.type="file";f.accept="image/*";
  f.onchange=e=>{
    const img=document.createElement("img");
    img.src=URL.createObjectURL(e.target.files[0]);
    img.className="char-img";
    p.appendChild(img);
  };
  f.click();
}

/* DRAG */
function enableDrag(p){
  p.onmousedown=e=>{
    if(e.target.classList.contains("resize"))return;
    active=p;
    active.style.zIndex=999;
    startX=e.clientX; startY=e.clientY;
    startLeft=p.offsetLeft; startTop=p.offsetTop;
    document.onmousemove=drag;
    document.onmouseup=stop;
  };
}
function drag(e){
  active.style.left=(startLeft+(e.clientX-startX))+"px";
  active.style.top=(startTop+(e.clientY-startY))+"px";
}
function stop(){
  document.onmousemove=null;
  active=null;
}

/* RESIZE */
function enableResize(p){
  p.querySelectorAll('.resize').forEach(h=>{
    h.onmousedown=e=>{
      active=p;
      startX=e.clientX; startY=e.clientY;
      startW=p.offsetWidth; startH=p.offsetHeight;
      startLeft=p.offsetLeft; startTop=p.offsetTop;
      document.onmousemove=ev=>resize(ev,h.classList[1]);
      document.onmouseup=stopResize;
    };
  });
}
function resize(e,c){
  if(c.includes('r')) active.style.width=(startW+(e.clientX-startX))+"px";
  if(c.includes('l')) active.style.width=(startW-(e.clientX-startX))+"px",active.style.left=(startLeft+(e.clientX-startX))+"px";
  if(c.includes('b')) active.style.height=(startH+(e.clientY-startY))+"px";
  if(c.includes('t')) active.style.height=(startH-(e.clientY-startY))+"px",active.style.top=(startTop+(e.clientY-startY))+"px";
}
function stopResize(){
  document.onmousemove=null;
  active=null;
}
</script>

</body>
</html>
