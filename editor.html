<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manhwa Page Mode Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;touch-action:none;margin:0;padding:0}

body{
  font-family:"Segoe UI", Arial, sans-serif;
  background:
    radial-gradient(circle at 10% 20%, #ff9a9e, transparent 40%),
    radial-gradient(circle at 90% 30%, #fad0c4, transparent 40%),
    radial-gradient(circle at 50% 80%, #fbc2eb, transparent 45%),
    linear-gradient(135deg,#a18cd1,#fbc2eb);
  overflow-x:hidden;
  padding-top:70px;
}

/* TOPBAR */
.topbar{
  position:fixed;
  top:0;left:0;width:100%;
  padding:16px;
  text-align:center;
  font-size:1.4rem;
  color:white;
  font-weight:700;
  z-index:1000;
}

/* BUTTONS */
button{
  cursor:pointer;
}

/* PAGE CONTAINER */
#pages{
  width:100%;
  display:flex;
  flex-direction:column;
  gap:40px;
  padding-bottom:120px;
}

/* EACH PAGE */
.page{
  width:380px;
  min-height:800px;
  background:white;
  box-shadow:0 0 25px rgba(0,0,0,0.25);
  border-radius:18px;
  margin:0 auto;
  position:relative;
  overflow:hidden;
  border:3px solid #000;
}

/* PAGE LABEL */
.page-label{
  text-align:center;
  font-weight:700;
  padding:6px;
  border-bottom:2px solid #000;
}

/* PAGE BUTTON BAR */
.page-tools{
  position:absolute;
  top:6px;right:6px;
  display:flex;
  gap:6px;
  z-index:20;
}
.page-tools button{
  font-size:11px;
  padding:4px 6px;
  border:none;
  border-radius:4px;
  background:#222;
  color:white;
}

/* PANEL */
.panel{
  position:absolute;
  top:120px;
  left:20px;
  width:200px;
  height:160px;
  border:2px solid #000;
  border-radius:8px;
  overflow:hidden;
  background:#eee;
  z-index:5;
}

/* BG */
.bg-layer{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  z-index:1;
}

/* CHARACTER IMG */
.char-img{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  max-height:90%;
  z-index:2;
}

/* CAPTION BOTTOM */
.caption{
  position:absolute;
  bottom:0;
  background:rgba(0,0,0,0.7);
  width:100%;
  color:white;
  padding:6px;
  font-size:12px;
  z-index:3;
  text-align:center;
}

/* PANEL TOOLS */
.tools{
  position:absolute;top:4px;left:4px;
  display:flex;gap:4px;z-index:6;
}
.tools button{
  font-size:10px;
  padding:2px 4px;
  border:none;border-radius:3px;
  background:#111;color:white;
}

/* DELETE */
.delete-panel{
  position:absolute;
  top:4px;right:4px;
  background:red;color:white;
  font-size:11px;padding:2px 5px;
  border:none;border-radius:3px;
  z-index:7;
}

/* RESIZE HANDLE */
.resize{
  position:absolute;
  width:16px;height:16px;
  background:#666;
  right:0;bottom:0;
  border-top-left-radius:4px;
  cursor:nwse-resize;
  z-index:8;
}

/* ADD PANEL BUTTON */
.add-panel-btn{
  width:100%;
  padding:10px;
  border:none;
  background:#ff5f6d;
  color:white;
  font-size:1rem;
  border-radius:8px;
  font-weight:700;
  margin-top:10px;
}

/* INPUT BAR */
.input-bar{
  position:fixed;
  bottom:0;left:0;
  width:100%;
  background:white;
  border-top:2px solid #ccc;
  display:flex;
  gap:8px;
  padding:10px;
}
.input-bar input{
  flex:1;
  padding:12px;
  border-radius:20px;
  border:1px solid #bbb;
  font-size:1rem;
}
.input-bar button{
  padding:12px 20px;
  border:none;
  background:#ff5f6d;
  border-radius:20px;
  font-weight:700;
  color:white;
}
</style>
</head>

<body>

<div class="topbar">ðŸ“œ Create Your Manhwa Pages</div>

<div id="pages"></div>

<!-- ADD PAGE BUTTON -->
<div style="text-align:center;margin:20px 0;">
  <button onclick="addPage()" class="add-panel-btn">âž• Add Page</button>
</div>

<!-- INPUT BAR -->
<div class="input-bar">
  <input id="scene-text" placeholder="Write caption...">
  <button onclick="addPanelToLast()">+ Panel</button>
</div>

<script>
let pages=[];
let lastPage=null;

/* ADD NEW PAGE */
function addPage(){
  const idx=pages.length+1;
  const pg=document.createElement("div");
  pg.className="page";
  pg.innerHTML=`
    <div class="page-label">PAGE ${idx}</div>
    <div class="page-tools">
      <button onclick="deletePage(this)">DEL</button>
    </div>
  `;
  document.getElementById("pages").appendChild(pg);
  pages.push(pg);
  lastPage=pg;
}

/* DELETE PAGE */
function deletePage(btn){
  const pg=btn.closest(".page");
  pg.remove();
}

/* ADD PANEL TO LAST PAGE */
function addPanelToLast(){
  if(!lastPage)addPage();
  const txt=document.getElementById("scene-text").value.trim()||"New scene";
  const p=document.createElement("div");
  p.className="panel";
  p.innerHTML=`
    <div class="bg-layer"></div>
    <div class="tools">
      <button onclick="bg(this)">BG</button>
      <button onclick="charAdd(this)">CHR</button>
    </div>
    <div class="caption">${txt}</div>
    <button class="delete-panel" onclick="this.closest('.panel').remove()">x</button>
    <div class="resize"></div>
  `;
  enableDrag(p,lastPage);
  enableResize(p);
  lastPage.appendChild(p);
  document.getElementById("scene-text").value="";
}

/* DRAG PANELS */
function enableDrag(p,container){
  let sx,sy;
  p.onmousedown=e=>{
    if(e.target.classList.contains("resize"))return;
    sx=e.clientX; sy=e.clientY;
    const rect=p.getBoundingClientRect();
    const offsetX=sx-rect.left;
    const offsetY=sy-rect.top;
    document.onmousemove=e2=>{
      const cx=e2.clientX-offsetX;
      const cy=e2.clientY-offsetY-window.scrollY;
      p.style.left=cx+"px";
      p.style.top=cy+"px";
    };
    document.onmouseup=()=>{document.onmousemove=null;}
  };
}

/* RESIZE */
function enableResize(p){
  const h=p.querySelector(".resize");
  let sx,sy,sw,sh;
  h.onmousedown=e=>{
    e.preventDefault();
    sx=e.clientX; sy=e.clientY;
    sw=p.offsetWidth; sh=p.offsetHeight;
    document.onmousemove=e2=>{
      p.style.width=(sw+(e2.clientX-sx))+"px";
      p.style.height=(sh+(e2.clientY-sy))+"px";
    };
    document.onmouseup=()=>document.onmousemove=null;
  };
}

/* BG UPLOAD */
function bg(btn){
  const p=btn.closest(".panel");
  const bg=p.querySelector(".bg-layer");
  const f=document.createElement("input");
  f.type="file"; f.accept="image/*";
  f.onchange=e=>{
    const r=new FileReader();
    r.onload=x=>bg.style.backgroundImage=`url(${x.target.result})`;
    r.readAsDataURL(e.target.files[0]);
  };
  f.click();
}

/* ADD CHARACTER */
function charAdd(btn){
  const p=btn.closest(".panel");
  const f=document.createElement("input");
  f.type="file"; f.accept="image/*";
  f.onchange=e=>{
    const img=document.createElement("img");
    img.src=URL.createObjectURL(e.target.files[0]);
    img.className="char-img";
    p.appendChild(img);
  };
  f.click();
}
</script>

</body>
</html>
