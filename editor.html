<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manhwa Free Canvas Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;touch-action:none}

body{
  margin:0;
  font-family:"Segoe UI", Arial, sans-serif;
  background:
    radial-gradient(circle at 10% 20%, #ff9a9e, transparent 40%),
    radial-gradient(circle at 90% 30%, #fad0c4, transparent 40%),
    radial-gradient(circle at 50% 80%, #fbc2eb, transparent 45%),
    linear-gradient(135deg,#a18cd1,#fbc2eb);
  overflow:hidden;
}

/* FREE DRAG CANVAS */
.canvas{
  position:relative;
  width:100%;
  height:100vh;
  overflow:auto;
  padding:90px 0 90px;
}

/* TITLE */
.topbar{
  position:fixed;
  top:0;left:0;width:100%;
  padding:16px;
  color:white;
  text-align:center;
  font-size:1.4rem;
  font-weight:700;
  z-index:1000;
}

/**********************
 PANEL = FREE SHAPE BOX
***********************/
.panel{
  position:absolute;
  top:120px;
  left:20px;
  width:300px;
  height:200px;
  border:3px solid #000;
  background:white;
  border-radius:6px;
  overflow:hidden;
  z-index:5;
}

/* BG layer only shows uploaded art */
.bg-layer{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
}

/* tools */
.tools{position:absolute;top:5px;left:5px;display:flex;gap:6px;z-index:10;}
.tools button{
  background:#111;
  color:white;
  border:none;
  font-size:10px;
  padding:2px 6px;
  border-radius:4px;
}

/* undo redo bottom left */
.history{
  position:absolute;
  bottom:8px;left:8px;
  display:flex;gap:6px;
  z-index:11;
}
.history button{
  font-size:10px;
  background:#333;
  color:white;
  border:none;
  padding:2px 6px;
  border-radius:4px;
}

/* delete */
.delete-panel{
  position:absolute;
  top:5px;right:5px;
  background:red;
  color:white;
  border:none;
  border-radius:4px;
  padding:3px 6px;
  font-size:11px;
  z-index:12;
}

/* corner resize handles */
.resize{
  width:14px;height:14px;background:#555;position:absolute;z-index:20;
}
.resize.br{right:0;bottom:0;cursor:nwse-resize;}
.resize.bl{left:0;bottom:0;cursor:nesw-resize;}
.resize.tr{right:0;top:0;cursor:nesw-resize;}
.resize.tl{left:0;top:0;cursor:nwse-resize;}
</style>
</head>

<body>

<div class="topbar">ðŸ“œ Create Your Manhwa</div>

<div class="canvas" id="canvas"></div>

<!-- input -->
<div style="position:fixed;bottom:0;left:0;width:100%;
 background:white;border-top:2px solid #ccc;
 padding:10px;display:flex;gap:8px;">
 <input id="scene" placeholder="Panel label (optional)" style="
   flex:1;padding:12px;border-radius:25px;border:1px solid #ccc;">
 <button onclick="addPanel()" style="
   padding:12px 20px;background:#ff5f6d;border-radius:25px;border:none;
   font-weight:700;color:white;">Add Scene</button>
</div>

<script>
function addPanel(){
  const txt=document.getElementById("scene").value.trim();
  const c=document.getElementById("canvas");

  const p=document.createElement("div");
  p.className="panel";
  p.style.left=(20+Math.random()*100)+"px";
  p.style.top=(120+Math.random()*300)+"px";

  p.innerHTML=`
    <div class="bg-layer"></div>

    <div class="tools">
      <button onclick="pickBG(this)">BG</button>
      <button onclick="addChar(this)">CHR</button>
    </div>

    <div class="history">
      <button onclick="undoPanel(this)">â†¶</button>
      <button onclick="redoPanel(this)">â†·</button>
    </div>

    <button class="delete-panel" onclick="this.parentNode.remove()">X</button>

    <!-- four resize corners -->
    <div class="resize tl"></div>
    <div class="resize tr"></div>
    <div class="resize bl"></div>
    <div class="resize br"></div>
  `;

  enableDrag(p);
  enableResize(p);
  c.appendChild(p);
  document.getElementById("scene").value="";
}

/****** BG upload ******/
function pickBG(btn){
  const p=btn.closest(".panel");
  const bg=p.querySelector(".bg-layer");
  const f=document.createElement("input");
  f.type="file"; f.accept="image/*";
  f.onchange=e=>{
    let r=new FileReader();
    r.onload=x=>bg.style.backgroundImage=`url(${x.target.result})`;
    r.readAsDataURL(e.target.files[0]);
  };
  f.click();
}

/****** Character *****/
function addChar(btn){
  const p=btn.closest(".panel");
  const f=document.createElement("input");
  f.type="file"; f.accept="image/*";
  f.onchange=e=>{
    const img=document.createElement("img");
    img.src=URL.createObjectURL(e.target.files[0]);
    img.style.position="absolute";
    img.style.bottom="0";
    img.style.left="50%";
    img.style.transform="translateX(-50%)";
    img.style.maxHeight="95%";
    img.style.zIndex="9";
    p.appendChild(img);
  };
  f.click();
}

/****** Drag free anywhere ******/
function enableDrag(p){
  let ox,oy,mx,my;
  p.onmousedown=e=>{
    if(e.target.classList.contains("resize"))return;
    ox=p.offsetLeft;
    oy=p.offsetTop;
    mx=e.clientX;
    my=e.clientY;
    document.onmousemove=ev=>{
      p.style.left=(ox+(ev.clientX-mx))+"px";
      p.style.top=(oy+(ev.clientY-my))+"px";
    };
    document.onmouseup=()=>document.onmousemove=null;
  };
}

/****** Resize in all directions ******/
function enableResize(p){
  let sx,sy,w,h;
  p.querySelectorAll(".resize").forEach(hndl=>{
    hndl.onmousedown=e=>{
      e.preventDefault();
      sx=e.clientX; sy=e.clientY;
      w=p.offsetWidth; h=p.offsetHeight;
      document.onmousemove=ev=>{
        let dx=ev.clientX-sx, dy=ev.clientY-sy;
        if(hndl.classList.contains("br")){
          p.style.width=(w+dx)+"px"; p.style.height=(h+dy)+"px";
        }
        if(hndl.classList.contains("bl")){
          p.style.width=(w-dx)+"px"; p.style.left=(p.offsetLeft+dx)+"px"; p.style.height=(h+dy)+"px";
        }
        if(hndl.classList.contains("tr")){
          p.style.width=(w+dx)+"px"; p.style.height=(h-dy)+"px"; p.style.top=(p.offsetTop+dy)+"px";
        }
        if(hndl.classList.contains("tl")){
          p.style.width=(w-dx)+"px"; p.style.left=(p.offsetLeft+dx)+"px"; 
          p.style.height=(h-dy)+"px"; p.style.top=(p.offsetTop+dy)+"px";
        }
      };
      document.onmouseup=()=>document.onmousemove=null;
    };
  });
}

/**** placeholder undo/redo ****/
function undoPanel(){alert("undo later")}
function redoPanel(){alert("redo later")}

</script>
</body>
</html>
